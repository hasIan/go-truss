# This Dockerfile builds an image that runs truss. Truss' Docker strategy
# is split into a build image to build Truss, and this image to run Truss,
# to keep the size of the run image as small as possible, since most users
# will not need to build Truss.
#
# To run properly, the directory containing the proto files Truss will read to
# generate a service must be mounted into the container, so that the output
# generated by Truss escapes the container.

# Using scratch as a base image would result in a slightly smaller image,
# which would be fine if Truss were a self-contained executable, but protoc
# has difficulty running on a scratch image. Using Alpine Linux alleviates
# these issues and only increases image size by about 5 MB.
FROM alpine:3.4
MAINTAINER lab@tune.com

ENV TRUSS_REPO github.com/TuneLab/go-truss
ENV TRUSS_PATH $GOPATH/src/$TRUSS_REPO

COPY build/protoc* build/truss /bin/
ADD build/shared-libs.tgz /

WORKDIR /truss

ENTRYPOINT ["/bin/truss"]
